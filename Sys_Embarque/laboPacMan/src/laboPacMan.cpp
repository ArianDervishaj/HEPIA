/*
 * laboPacMan.cpp
 *
 *  Created on:
 *      Author:
 */

#include "mbed.h"

BusOut red(P2_4,P2_5,P2_6,P2_7,P2_8,P2_10,P2_11,P2_12 );
BusOut green(P0_4,P0_5,P0_10,P0_11,P2_0,P2_1,P2_2,P2_3);
BusOut blue(P0_23,P0_24,P0_25,P0_26,P1_30,P1_31,P0_2,P0_3);
BusOut row(P0_15,P0_17,P0_18,P0_1,P0_0,P0_6,P0_7,P0_8);

Ticker ticker;
Ticker animation;

int i = 0;
int frame = 0;

int frames[][8][4] = {
	{
		{0x01, 0x3c, 0x3c, 0x00},
		{0x02, 0x7e, 0x7e, 0x00},
		{0x04, 0xff, 0xff, 0x00},
		{0x08, 0xff, 0xff, 0x00},
		{0x10, 0xff, 0xff, 0x00},
		{0x20, 0xff, 0xff, 0x00},
		{0x40, 0x7e, 0x7e, 0x00},
		{0x80, 0x3c, 0x3c, 0x00}
	},
	{
	    {0x01, 0x3c, 0x3c, 0x00},
	    {0x02, 0x7e, 0x7e, 0x00},
	    {0x04, 0xfc, 0xfc, 0x00},
	    {0x08, 0xf0, 0xf0, 0x00},
	    {0x10, 0xf0, 0xf0, 0x00},
	    {0x20, 0xfc, 0xfc, 0x00},
	    {0x40, 0x7e, 0x7e, 0x00},
	    {0x80, 0x3c, 0x3c, 0x00}
	},
	{
		{0x01, 0x3c, 0x3c, 0x00},
	    {0x02, 0x7e, 0x7e, 0x00},
	    {0x04, 0xfc, 0xfc, 0x00},
	    {0x08, 0xf5, 0xf0, 0x05},
	    {0x10, 0xfa, 0xf0, 0x0a},
	    {0x20, 0xfc, 0xfc, 0x00},
	    {0x40, 0x7e, 0x7e, 0x00},
	    {0x80, 0x3c, 0x3c, 0x00}
	},
	{
		{0x01, 0x3c, 0x3c, 0x00},
	    {0x02, 0x7e, 0x7e, 0x00},
	    {0x04, 0xfc, 0xfc, 0x00},
	    {0x08, 0xfa, 0xf0, 0x0a},
	    {0x10, 0xf5, 0xf0, 0x05},
	    {0x20, 0xfc, 0xfc, 0x00},
	    {0x40, 0x7e, 0x7e, 0x00},
	    {0x80, 0x3c, 0x3c, 0x00}
	}
};

void switch_frame(void) {
    frame = (frame + 1) % 4;
}

void exercice1(void) {
    row = frames[frame][i][0];
    red = frames[frame][i][1];
    green = frames[frame][i][2];
    blue = frames[frame][i][3];

	i = (i+1) % 8;
}

int main(void) {
	// Choisir le numero de l'exercice en changeant la valeur de 'exo'.
	ticker.attach(&exercice1, 0.001);
	animation.attach(&switch_frame,0.25);

	while(1){}
}
